
Target:
  name: RISCV
Templates:
  {
    Rtype:
      {
        template: "{mnem} {rd}, {rs1}, {rs2}",
        oprands:
          {
            rd: { type: GPR, flag: Def },
            rs1: { type: GPR, flag: Use },
            rs2: { type: GPR, flag: Use },
          },
      },
    IType:
      {
        template: "$mnem $rd, $rs1, $imm",
        oprands:
          {
            rd: { type: GPR, flag: Def },
            rs1: { type: GPR, flag: Use },
            imm: { type: IMM12, flag: Metadata },
          },
      },
    SType:
      {
        template: "$mnem $rs2, $offset($rs1)",
        oprands:
          {
            rs1: { type: GPR, flag: Use }, # BaseLike
            rs2: { type: GPR, flag: Use },
            offset: { type: IMM12, flag: Metadata },
          },
      },
    UType:
      {
        template: "$mnem $rd, $imm",
        oprands:
          {
            rd: { type: GPR, flag: Def },
            imm: { type: IMM20, flag: Metadata },
          },
      },
    # for Pseudos
    # R2Type: {
    #   template: "$mnem $rd, $rs",

    # }
  }
Instances: {
    # RRR
    ADD: { mnem: "add", template: Rtype },
    SUB: { mnem: "sub", template: Rtype },
    XOR: { mnem: "xor", template: Rtype },
    OR: { mnem: "or", template: Rtype },
    AND: { mnem: "and", template: Rtype },
    SLL: { mnem: "sll", template: Rtype },
    SRL: { mnem: "srl", template: Rtype },
    SRA: { mnem: "sra", template: Rtype },
    SLT: { mnem: "slt", template: Rtype },
    SLTU: { mnem: "sltu", template: Rtype },
    # RII
    ADDI: { mnem: "addi", template: IType },
    XORI: { mnem: "xori", template: IType },
    ORI: { mnem: "ori", template: IType },
    ANDI: { mnem: "andi", template: IType },
    SLTI: { mnem: "slti", template: IType },
    SLTIU: { mnem: "sltiu", template: IType },
    # RII-shift
    SLLI:
      {
        mnem: "slli",
        template: IType,
        operands: { imm: { type:UIMM6, flag: Metadata } },
      },
    SRLI:
      {
        mnem: "srli",
        template: IType,
        operands: { imm: { type:UIMM6, flag: Metadata } },
      },
    SRAI:
      {
        mnem: "srai",
        template: IType,
        operands: { imm: { type:UIMM6, flag: Metadata } },
      },
    # Load
    LB: { mnem: "lb", template: IType, flag: [Load] },
    LH: { mnem: "lh", template: IType, flag: [Load] },
    LW: { mnem: "lw", template: IType, flag: [Load] },
    LBU: { mnem: "lbu", template: IType, flag: [Load] },
    LHU: { mnem: "lhu", template: IType, flag: [Load] },
    # Store
    SB: { mnem: "sb", template: SType, flag: [Store] },
    SH: { mnem: "sh", template: SType, flag: [Store] },
    SW: { mnem: "sw", template: SType, flag: [Store] },
    # branch Btype-Itype offset-imm
    BEQ: { mnem: "beq", template: IType, flag: [Branch, Terminator] }, 
    BNE: { mnem: "bne", template: IType, flag: [Branch, Terminator] }, 
    BLT: { mnem: "blt", template: IType, flag: [Branch, Terminator] }, 
    BGE: { mnem: "bge", template: IType, flag: [Branch, Terminator] }, 
    BLTU: { mnem: "bltu", template: IType, flag: [Branch, Terminator] }, 
    BGEU: { mnem: "bgeu", template: IType, flag: [Branch, Terminator] }, 
    # J JType-Utype 
    JAL: { mnem: "jal", template: UType, flag: [Call] },
    JALR: { mnem: "jalr", template: IType, flag: [Call] },
  
    # RIU lui, auipc
    LUI: { mnem: "lui", template: UType, flag: [LoadConstant] },
    AUIPC: { mnem: "auipc", template: UType, flag: [PCRel, LoadConstant] },
    # Pseudos
    # nop

    # MV: { }



  }

InstSelection: [
  {
    Pattern: {
      InstLoadGlobalAddress: { Dst: $Dst, Addr: $Addr}
    },
    Replace: a
  },
  {
    Pattern: {
      InstLoadGlobalAddress: a,
      InstLoadGlobalValue: b
    },
    Replace: a
  }
  ]

