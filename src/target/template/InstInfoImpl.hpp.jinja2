// Automatically generated file, do not edit!

#pragma once
#include "mir/mir.hpp"
#include "mir/instinfo.hpp"
#include "target/{{target_name.lower()}}/InstInfoDecl.hpp"

{{target_name}}_NAMESPACE_BEGIN

{% for inst_name in insts_list %}
{% if inst_name in insts_dict %}
class {{target_name}}InstInfo{{inst_name}} final: public InstInfo {
public:
    {{target_name}}InstInfo{{inst_name}}() = default;

    uint32_t operand_num() override {
        return {{insts_dict[inst_name].operands|length}};
    }

    OperandFlag operand_flag(uint32_t idx) override{
        switch (idx) {
            {%- for idx, op in insts_dict[inst_name].operands.items() -%}
                case {{idx}}:
                    return OperandFlag{{op.flag}};
            {%- endfor -%}
            default:
                assert(false && "Invalid operand index");
        }
    }
    
    uint32_t inst_flag() override {
        return InstFlagNone 
            {%- for flag in insts_dict[inst_name].flag -%}
                | InstFlag{{flag}} 
            {%- endfor -%};
    }

    std::string_view name() override{
        return "{{target_name}}.{{inst_name}}";
    }

    void print(std::ostream& out, MIRInst& inst, bool comment) override{        
        out 
        {%- for part in insts_dict[inst_name].format -%}
            <<
            {%- if part is integer -%}
            mir::{{target_name}}::OperandDumper{ inst.operand({{part}}) }
            {%- else -%}
                "{{part}}"
            {%- endif -%}
        {%- endfor %};

        {%- if insts_dict[inst_name].comment|length != 0 -%}
            if (comment) {
                out 
                {%- for part in insts_dict[inst_name].comment -%}
                    {%- if part is integer -%} 
                        << insts_dict[inst_name].operand({{part}})
                    {%- else -%}
                        "{{part}}"
                    {%- endif -%}
                {%- endfor -%};
            }
        {%- endif -%}
    }


};
{% endif %}
{% endfor %}

class {{target_name}}InstInfo final: public TargetInstInfo {
    {%- for inst_name in insts_list -%}
    {% if inst_name in insts_dict -%}
    {{target_name}}InstInfo{{inst_name}} _instinfo{{inst_name}};
    {% endif -%}
    {%- endfor -%}
public:
    {{target_name}}InstInfo() = default;
    InstInfo& get_instinfo(uint32_t opcode) {
        switch (opcode) {
            {% for inst_name in insts_list -%}
            case {{target_name}}Inst::{{inst_name}}:
            {% if inst_name in insts_dict -%}
                return _instinfo{{inst_name}};
            {%- else -%}
                break; /* not supported */
            {%- endif %}
            {%- endfor %}
            default:
                return TargetInstInfo::get_instinfo(opcode);
        }
    }
};

TargetInstInfo& get{{target_name}}InstInfo() {
    static {{target_name}}InstInfo instance;
    return instance;
}
{{target_name}}_NAMESPACE_END
